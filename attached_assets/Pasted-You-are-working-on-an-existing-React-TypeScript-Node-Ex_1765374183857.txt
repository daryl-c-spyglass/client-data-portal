You are working on an existing React + TypeScript + Node/Express project hosted on Replit. This project is an IDX / CMA platform for Spyglass Realty.

High-level context
- Historically this app used MLS Grid data.
- The project now has a unified search implementation:
  - status=active or status=under_contract → query Repliers API
  - status=closed or status=sold → query local PostgreSQL database
- There is already a `/api/search` endpoint and a unified `unifiedSearch` client helper.
- My client wants to **use Repliers for this project going forward** (for active & under-contract listings), while still using the local DB for closed/sold where appropriate.
- The UI layout & styling are already good; the goal is to make everything actually work and align calculation logic with what agents expect.

I have attached:
- Screenshots of:
  - Dashboard
  - Properties (search criteria, results, map tab, property detail page)
  - CMAs list and “Create New CMA”
  - Seller Updates list and “Create Seller Update”
- A sample **Quick CMA PDF** (“Quick CMA 2740.pdf”) generated by a 3rd-party system (for Cherry Creek, 1200–1800 sqft) that we need to **match**.
- Repliers and MLS Grid documentation PDFs that already exist in the repo.
Please open and use those as reference for data fields, status codes, and expected behavior.

Your job
Act like a senior full-stack engineer following the Replit “vibe coding” philosophy:
- Think procedurally, propose a plan, then execute it step-by-step.
- Use the existing design system and components.
- Prefer incremental, well-scoped edits with clear checkpoints.
- Use the browser console & network tab to debug issues when you run the app.

Overall goal
Make the following sections **fully functional and aligned with Repliers + local DB**:

1) Dashboard
2) Properties (search criteria, results, property detail, map tab)
3) CMA Builder / CMAs
4) Seller Updates
5) Property images and property details (description, amenities, history, neighborhood)

Also:
- Ensure CMA statistics and property values **match the attached Quick CMA** when using the same comparables.
- Ensure the app correctly pulls **images and listing details from Repliers** wherever available.

-----------------------------------
A. Start by understanding the current implementation
-----------------------------------
1. Scan these key files (names may differ slightly; search if needed):
   - `server/routes.ts`
   - `server/storage.ts`
   - Any Repliers-specific service or client modules.
   - `client/src/api.ts` (or wherever `unifiedSearch` is defined).
   - `client/src/pages/Dashboard.tsx`
   - `client/src/pages/Properties.tsx`
   - `client/src/components/SearchCriteria.tsx`
   - `client/src/pages/CMABuilder.tsx` (or similar CMA builder file)
   - `client/src/pages/CMAs.tsx`
   - `client/src/pages/SellerUpdateList.tsx` (or similar)
   - `client/src/pages/SellerUpdateNew.tsx`
   - `client/src/pages/PropertyDetail.tsx` or any property-details component.
2. Confirm how the unified search endpoint is wired:
   - How `/api/search` maps to Repliers vs. local DB.
   - How statuses are normalized (e.g. Repliers ‘A’, ‘U’ → ‘Active’, ‘Active Under Contract’, etc.).
   - How numeric fields are preserved (listPrice, closePrice, livingArea, yearBuilt, latitude, longitude, daysOnMarket, etc.).

Please then create a short inline comment or TODO block summarizing what you found about the current architecture (no need to show me, just keep it in the code).

-----------------------------------
B. Fix & enhance each feature area
-----------------------------------

=== 1) Dashboard ===
Problems:
- Metric cards (Total Properties, Active CMAs, Saved Searches, System Status) are currently empty or not wired correctly.
- Manual “Sync MLS Data” is likely obsolete or failing now that we rely on Repliers.

What to do:
1. Implement a backend dashboard stats endpoint (if not already done), e.g. `/api/dashboard/stats`, that returns:
   - totalActiveProperties: count of active + under-contract listings from Repliers.
   - totalClosedProperties: count of closed/sold listings in the local DB if useful.
   - activeCMAs: count of CMAs in the system.
   - savedSearches: count of saved searches if this concept exists, or 0 for now.
   - systemStatus: a simple string like "Ready" or a more detailed health summary (e.g., can we reach Repliers API? DB?).
2. Update `Dashboard.tsx` to:
   - Fetch these stats via the new endpoint.
   - Display the numbers in the existing cards.
3. Enhancement request:
   - Add at least **one simple graph** (line chart or bar chart) that helps realty agents visualize key metrics (for example: number of new active listings per week, or closed listings trend for the last 30/60/90 days).
   - Use an existing charting library already in the project; if none exists, pick a light-weight option and integrate minimally.
   - Keep the style consistent with the current UI.

Ensure the dashboard loads without errors and shows real data pulled from Repliers/local DB, not hard-coded numbers.

=== 2) Properties section ===
Current behavior / problems:
- Search criteria form works for basic queries, but:
  - Suggestive/autocomplete inputs are missing for:
    - Neighborhood
    - Subdivisions
    - Cities
    - Zip Codes
  - The “View Map” tab just shows “Interactive map coming soon…”
  - In property results:
    - **Property photos/images are missing** on the result cards.
    - When clicking into a property detail:
      - The top image area is empty.
      - Description, Features & Amenities, Property History, Neighborhood sections are often empty.
      - Location section sometimes shows “Interactive map coming soon” instead of a real map.
      - Right-side actions (Schedule Viewing, Add to CMA, Save, Share) are not wired to any behavior.

What to do:
1. Autocomplete / suggestive inputs
   - In the backend (`server/storage.ts` + routes):
     - Implement autocomplete endpoints backed by Repliers + local DB where appropriate:
       - `/api/autocomplete/neighborhoods`
       - `/api/autocomplete/subdivisions`
       - `/api/autocomplete/cities`
       - `/api/autocomplete/postalCodes`
     - Where possible, reuse or generalize any existing autocomplete logic for schools (the Replit agent previously implemented school autocomplete).
   - On the frontend (`SearchCriteria` and any related components):
     - Wire the Neighborhood, Subdivision, Cities, and Zip Codes fields to use the AutocompleteInput component pattern already used for school fields.
     - Ensure we debounce requests and display suggestions as the user types.
2. Property images in results and detail views
   - Confirm how Repliers returns media/photo URLs for listings.
   - Extend the unified search normalization so each listing includes an `photos` (or `images`) array with at least one main URL.
   - In the Properties result cards:
     - Display the primary image from Repliers; if missing, show a reasonable placeholder.
   - In the Property Detail page:
     - Show a larger image or gallery using the same Repliers URLs.
3. Property detail data (description, amenities, history, neighborhood)
   - Check if Repliers or the local DB returns:
     - Public remarks / description
     - Features & amenities
     - Basic property history (sold date, previous list price, etc.)
     - Neighborhood or subdivision information
   - Map those fields into the property detail endpoint/DTO.
   - Update the detail page tabs (“Description”, “Features & Amenities”, “Property History”, “Neighborhood”) to display real values where available. If something truly isn’t available, show a graceful message but try to pull as much as Repliers exposes.
4. Location / interactive map
   - Replace “Interactive map coming soon” with an actual interactive map.
   - You may use Leaflet or another lightweight map solution consistent with the project’s existing patterns.
   - Use the property latitude/longitude from Repliers/local DB to place a marker.
5. Actions on the property detail page
   - Schedule Viewing:
     - For now, make this open a simple modal or route to a basic form where an agent can enter contact info and notes. It doesn’t have to fully integrate with an external calendar yet, but should not be a dead button.
   - Add to CMA:
     - Wire this to the CMA system so that when clicking “Add to CMA” from a property detail, the property can be added as:
       - Subject property **or**
       - Comparable property
       (you can use a simple dialog or route to CMA Builder with a query param).
   - Save:
     - Persist a “saved property” flag somewhere (local DB or simple table). If there’s already a concept of saved properties, reuse it.
   - Share:
     - At minimum, open a modal that provides a copyable public URL to this property (or a placeholder if public URLs are not yet implemented).

Make sure list view and detail view work for:
- Active listings (Repliers)
- Under contract (Repliers)
- Closed/Sold listings (local DB via unified search)

=== 3) CMA Builder / CMAs ===
Critical requirement:
- My client provided a third-party **Quick CMA PDF for Cherry Creek**, with:
  - Subdivision: Cherry Creek
  - Square footage range: 1200–1800 sqft
  - A specific set of sold comparables, and resulting average / price metrics.
- When we build a CMA in our system using **the same subdivision, sqft range, and comparables**, we should get **matching or very close** statistics (list price averages, sold price per sqft, etc.).

Current problems:
- When entering “Cherry Creek”:
  - Active & Under Contract results are not showing as expected.
  - For Closed/Sold, the results appear but their calculations may be wrong (e.g. previous case: picking 4 listings between $2.9M–$3.2M produced a result around $575K, which is obviously incorrect for the average).
- CMA Builder’s status dropdown now supports Active, Under Contract, and Closed/Sold, but we need to confirm:
  - It queries the same unified `/api/search` endpoint as Properties.
  - It uses **consistent status normalization**.
- CMA statistics (e.g. avg list price, avg sold price, price per sqft, DOM) may not be calculated correctly.

What to do:
1. Wire CMA Builder to unified search correctly:
   - Ensure the CMA Builder search form uses the same unified search logic as Properties.
   - Check that filters like City, Subdivision, sqft range, status (Active / Under Contract / Closed/Sold) are passed correctly to the backend.
2. Fix CMA calculations:
   - Inspect how CMA metrics are derived.
   - Confirm that:
     - Averages are computed over the selected comparables (not all listings).
     - Price per sqft is calculated as `closePrice / livingArea` or `listPrice / livingArea`, depending on context.
     - Outliers or missing numeric values are handled safely.
3. Validate against the attached Quick CMA:
   - Reproduce the Quick CMA for Cherry Creek:
     - Use subdivision Cherry Creek.
     - Use the sqft range 1200–1800.
     - Select the same sold comparables as shown in the PDF.
   - Ensure the resulting stats align with the Quick CMA numbers (within minor rounding differences).
   - If there are mismatches, adjust the calculations or filters until they match.
4. Address & status visibility:
   - Ensure CMA search results clearly show:
     - Address
     - Status (Active, Under Contract, Closed/Sold)
     - List price, Close price, sqft, DOM
   - Make sure address is visible everywhere properties are listed in the CMA Builder.

=== 4) Seller Updates ===
Current behavior / problems:
- On the Seller Updates list page, existing cards show Zip Code, School, Type, Frequency correctly.
- When creating a new Seller Update:
  - **Elementary School field** should have typeahead/autocomplete (similar to Buyer Search school autocomplete), but currently behaves like a simple Select and sometimes throws a runtime error if value is empty.
  - **Property Type** currently shows only “All Types” instead of a dropdown of all property subtypes.
  - There were earlier issues with `<Select.Item/>` requiring a non-empty value; those must be fully resolved.

What to do:
1. Elementary School autocomplete:
   - Reuse the school autocomplete endpoints and AutocompleteInput already implemented for Buyer Search.
   - Ensure the Seller Update “Elementary School” field:
     - Supports suggestive dropdown as the user types.
     - Properly saves the selected school in the Seller Update configuration.
2. Property Type dropdown:
   - Populate “Property Type” with real property subtypes from Repliers/MLS (e.g., Single Family, Condo, Townhouse, etc.).
   - Allow “All Types” but also other specific types.
   - Ensure saving and loading existing Seller Updates respects this field.
3. Fix any Select runtime errors:
   - Ensure all `<Select>` components supply valid non-empty values to `<Select.Item/>`, and default states are handled correctly (no empty string value that breaks the component).

Check that:
- Creating a Seller Update works end-to-end without runtime overlays.
- The new Seller Update appears correctly in the Seller Updates list.

=== 5) Property images & details (cross-cutting) ===
Additional explicit requirement:
- **Property images/pictures are missing** both in:
  - The Properties search results cards.
  - The Property Detail page.
- The system *can* get data and images from Repliers, but they are not currently wired in.

What to do:
1. Confirm the response shape from Repliers that contains photo URLs.
2. Extend the normalization layer so each listing object contains a consistent `photos` array (or equivalent), with at least:
   - `photos[0]` as a primary image URL.
3. Update:
   - Properties results cards to show the primary image.
   - Property detail to show a large primary image and, if available, a simple gallery or carousel.
4. Ensure that if an image is missing, we fall back to a graceful placeholder but do not crash.

Also ensure:
- Description, features, amenities, property history, and neighborhood fields are populated when Repliers or the DB provides that data.
- Only show “No description available” or “Property history information coming soon” when the data is truly not available.

-----------------------------------
C. Testing and sample flows
-----------------------------------
Please verify at least these flows:

1) Properties + detail
- Run a search with:
  - City: Austin
  - Various statuses (Active, Under Contract, Closed/Sold).
- Confirm:
  - Cards show address, price, beds, baths, sqft, and **images**.
  - Clicking a property:
    - Shows image, address, beds/baths, sqft, year built.
    - Shows description/amenities/history/neighborhood when available.
    - Shows a working map with marker.
    - Buttons (Schedule Viewing, Add to CMA, Save, Share) perform some reasonable action.

2) CMA Builder
- Create a CMA for Cherry Creek using the attached Quick CMA PDF as reference:
  - Subdivision: Cherry Creek.
  - Sqft range: 1200–1800.
  - Select the same sold comparables as shown in the PDF.
- Confirm:
  - CMA statistics (avg price, price per sqft, etc.) align with the Quick CMA.
  - Status filters and address display work as expected.

3) Seller Update
- Create a Seller Update:
  - Enter a Zip Code.
  - Use Elementary School autocomplete to select a school.
  - Pick a specific Property Type (e.g. Single Family, Condo).
  - Set frequency Weekly.
- Save and verify:
  - The new update appears in the Seller Updates list with all fields populated.
  - No runtime overlay errors appear.

4) Dashboard
- Load the Dashboard and confirm:
  - Cards show real metrics.
  - The new graph renders correctly and uses real data.

-----------------------------------
D. General guidelines
-----------------------------------
- Keep the existing design and layout intact; focus on data wiring, correctness, and UX behavior.
- Preserve numeric types (prices, sqft, lat/lng, DOM) as numbers, not strings.
- Handle missing data gracefully with fallbacks instead of crashes.
- When unsure about a field’s meaning, check the attached Repliers and MLS documentation in the repo.

When you’re done, please:
- Leave a short summary of the main changes in `replit.md` (or an equivalent project notes file), including:
  - What endpoints you added/changed.
  - Where CMA logic was fixed.
  - How images and maps are now sourced from Repliers.
  - Any limitations or TODOs.

Now please start by outlining your plan (a short checklist) and then implement it step-by-step, using checkpoints after each major milestone.
